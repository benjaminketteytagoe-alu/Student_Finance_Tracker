<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Tracker Tests</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 2rem;
        }

        .test-section {
            margin: 2rem 0;
            padding: 1rem;
            border: 1px solid #ccc;
        }

        .test-result {
            margin: 0.5rem 0;
            padding: 0.5rem;
        }

        .pass {
            background: #d4edda;
            color: #155724;
        }

        .fail {
            background: #f8d7da;
            color: #721c24;
        }

        button {
            margin: 0.5rem;
            padding: 0.5rem 1rem;
        }
    </style>
</head>

<body>
    <h1>Finance Tracker Validation Tests</h1>

    <div class="test-section">
        <h2>Regex Pattern Tests</h2>

        <div class="test-result" id="description-test">
            <h3>Description Validation</h3>
            <button onclick="testDescription()">Run Description Tests</button>
        </div>

        <div class="test-result" id="amount-test">
            <h3>Amount Validation</h3>
            <button onclick="testAmount()">Run Amount Tests</button>
        </div>

        <div class="test-result" id="date-test">
            <h3>Date Validation</h3>
            <button onclick="testDate()">Run Date Tests</button>
        </div>

        <div class="test-result" id="category-test">
            <h3>Category Validation</h3>
            <button onclick="testCategory()">Run Category Tests</button>
        </div>

        <div class="test-result" id="search-test">
            <h3>Search Regex Tests</h3>
            <button onclick="testSearch()">Run Search Tests</button>
        </div>
    </div>

    <script type="module">
        import { validateDescription, validateAmount, validateDate, validateCategory, PATTERNS } from './scripts/validators.js';
        import { compileRegex, safeSearch } from './scripts/search.js';

        window.testDescription = function ()
        {
            const tests = [
                { input: 'Lunch', expected: true },
                { input: ' Lunch', expected: false },
                { input: 'Lunch ', expected: false },
                { input: 'Lunch  dinner', expected: false },
                { input: 'Coffee coffee', expected: false },
                { input: 'A', expected: true },
                { input: '', expected: false }
            ];

            runTests( 'description-test', tests, validateDescription );
        };

        window.testAmount = function ()
        {
            const tests = [
                { input: '12.50', expected: true },
                { input: '12.5', expected: true },
                { input: '12.505', expected: false },
                { input: '0', expected: true },
                { input: '012', expected: false },
                { input: '-5', expected: false },
                { input: 'abc', expected: false }
            ];

            runTests( 'amount-test', tests, validateAmount );
        };

        window.testDate = function ()
        {
            const tests = [
                { input: '2025-09-25', expected: true },
                { input: '2025-13-01', expected: false },
                { input: '2025-09-32', expected: false },
                { input: '25-09-25', expected: false },
                { input: '2025/09/25', expected: false },
                { input: '2025-02-29', expected: true },
                { input: '2026-02-29', expected: false }
            ];

            runTests( 'date-test', tests, validateDate );
        };

        window.testCategory = function ()
        {
            const tests = [
                { input: 'Food', expected: true },
                { input: 'Student Fees', expected: true },
                { input: 'Food-Drink', expected: true },
                { input: 'Food123', expected: false },
                { input: 'Food!', expected: false },
                { input: '', expected: false }
            ];

            runTests( 'category-test', tests, validateCategory );
        };

        window.testSearch = function ()
        {
            const testData = [
                { id: '1', description: 'Coffee with friends', amount: 8.75, category: 'Food', date: '2025-09-28' },
                { id: '2', description: 'Chemistry textbook', amount: 89.99, category: 'Books', date: '2025-09-23' },
                { id: '3', description: 'Coffee coffee duplicate', amount: 5.00, category: 'Food', date: '2025-09-29' }
            ];

            const tests = [
                { pattern: 'coffee', expected: 2 },
                { pattern: '/coffee/i', expected: 2 },
                { pattern: '/\\d+\\.\\d{2}\\b/', expected: 3 },
                { pattern: '/\\b(\\w+)\\s+\\1\\b/', expected: 1 },
                { pattern: '/textbook/', expected: 1 },
                { pattern: '/[', expected: 'error' }
            ];

            const container = document.getElementById( 'search-test' );
            container.innerHTML = '<h3>Search Regex Tests</h3><button onclick="testSearch()">Run Search Tests</button>';

            tests.forEach( test =>
            {
                const result = safeSearch( testData, test.pattern );
                const div = document.createElement( 'div' );
                div.className = `test-result ${ result.isValid && result.matchCount === test.expected ? 'pass' : 'fail' }`;

                if ( test.expected === 'error' )
                {
                    div.textContent = `Pattern: ${ test.pattern } - Expected error, got ${ result.isValid ? 'valid' : 'invalid' }`;
                } else
                {
                    div.textContent = `Pattern: ${ test.pattern } - Expected ${ test.expected } matches, got ${ result.matchCount }`;
                }

                container.appendChild( div );
            } );
        };

        function runTests ( containerId, tests, validator )
        {
            const container = document.getElementById( containerId );
            container.innerHTML = `<h3>${ validator.name } Tests</h3><button onclick="test${ validator.name.split( 'validate' )[ 1 ] }()">Run Tests</button>`;

            tests.forEach( test =>
            {
                const result = validator( test.input );
                const div = document.createElement( 'div' );
                div.className = `test-result ${ result.isValid === test.expected ? 'pass' : 'fail' }`;
                div.textContent = `Input: "${ test.input }" - Expected: ${ test.expected }, Got: ${ result.isValid }`;
                if ( !result.isValid && result.error )
                {
                    div.textContent += ` - Error: ${ result.error }`;
                }
                container.appendChild( div );
            } );
        }
    </script>
</body>

</html>